<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WM Barcode Generator</title>
    <style>
:root {
  --bg: #0b0e12;
  --card: #12161d;
  --muted: #9aa4b2;
  --text: #e6edf3;
  --primary: #4f8cff;
  --primary-600: #3b6ed1;
  --danger: #ff5d5d;
  --warning: #f2b84b;
  --success: #36c37e;
  --border: #1e2633;
}

* { box-sizing: border-box; }
html, body { height: 100%; }
body {
  margin: 0;
  font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
  color: var(--text);
  background: radial-gradient(1200px 800px at 80% -10%, #1b2340 0%, #0b0e12 45%) no-repeat fixed;
}

.container {
  max-width: 900px;
  margin: 0 auto;
  padding: 24px 16px 48px;
}

header h1 {
  margin: 0 0 4px 0;
  font-size: 28px;
  font-weight: 700;
}
.subtitle { color: var(--muted); margin: 0 0 16px 0; }

.card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 16px;
  margin: 16px 0;
  box-shadow: 0 10px 30px rgba(0,0,0,0.25);
}

label { display: block; margin-bottom: 8px; font-weight: 600; }
.input-row { display: flex; gap: 8px; }

input[type="text"], input:not([type]) {
  flex: 1;
  padding: 12px 12px;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: #0e131a;
  color: var(--text);
  outline: none;
}
input::placeholder { color: #667085; }

button { cursor: pointer; border-radius: 10px; border: 1px solid transparent; height: 44px; padding: 0 14px; font-weight: 600; }
.primary { background: var(--primary); color: white; }
.primary:hover { background: var(--primary-600); }
.secondary { background: #0f1520; color: var(--text); border-color: var(--border); }
.secondary:hover { background: #131a28; }
.ghost { background: transparent; color: var(--muted); border-color: var(--border); }
.ghost:hover { color: var(--text); }

.help { color: var(--muted); margin-top: 6px; }
.error { color: var(--danger); margin-top: 8px; min-height: 20px; }

/* Links */
a { color: var(--primary); text-decoration: none; }
a:visited { color: var(--primary); }
a:hover { color: var(--primary-600); text-decoration: underline; }

.result-header { display: flex; align-items: center; justify-content: space-between; gap: 12px; }
.label { color: var(--muted); font-size: 12px; }
.mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
.actions { display: flex; gap: 8px; }
.barcode-wrap { display: grid; place-items: center; padding: 16px; background: #0f1420; border: 1px dashed var(--border); border-radius: 10px; margin-top: 12px; }

.list-header { display: flex; align-items: center; justify-content: space-between; }
.toggle { display: inline-flex; align-items: center; gap: 8px; color: var(--muted); }

.codes-list { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 8px; }
.codes-item { display: flex; align-items: center; justify-content: space-between; gap: 12px; padding: 12px; border: 1px solid var(--border); border-radius: 10px; background: #0f1420; }
.codes-main { display: flex; flex-direction: column; gap: 4px; }
.codes-meta { color: var(--muted); font-size: 12px; }
.badge { display: inline-flex; align-items: center; gap: 6px; padding: 2px 8px; border-radius: 999px; font-size: 12px; border: 1px solid var(--border); }
.badge.partial { background: rgba(242, 184, 75, 0.1); color: var(--warning); border-color: rgba(242,184,75,0.3); }
.badge.archived { background: rgba(154, 164, 178, 0.08); color: var(--muted); }
.item-actions { display: flex; gap: 8px; }
.danger { background: rgba(255,93,93,0.1); color: var(--danger); border-color: rgba(255,93,93,0.2); }
.danger:hover { background: rgba(255,93,93,0.2); }

.empty { color: var(--muted); text-align: center; padding: 12px; }

footer { margin-top: 24px; color: var(--muted); }

@media (max-width: 520px) {
  .result-header { flex-direction: column; align-items: stretch; }
  .actions { justify-content: flex-end; }
}
    </style>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <meta name="description" content="Generate and save barcodes for 16-digit bonus codes.">
</head>
<body>
    <div class="container">
        <header>
            <h1>WM Barcode Generator</h1>
            <p class="subtitle">Format: <code>79936686504000ABCDEFGHIJKLMNOP</code> where <code>ABCDEFGHIJKLMNOP</code> is your 16-digit bonus code.</p>
        </header>

        <section class="card">
            <form id="barcode-form" novalidate>
                <label for="bonusCode">Enter 16-digit bonus code</label>
                <div class="input-row">
                    <input id="bonusCode" name="bonusCode" inputmode="numeric" autocomplete="off" placeholder="Enter 16 digits" maxlength="16" aria-describedby="bonusCodeHelp" required>
                    <button type="submit" class="primary">Generate</button>
                </div>
                <div id="bonusCodeHelp" class="help">Only digits 0-9, exactly 16 characters.</div>
                <div id="error" class="error" role="alert" aria-live="polite"></div>
            </form>
        </section>

        <section class="card" id="result-card" hidden>
            <div class="result-header">
                <div>
                    <div class="label">Full barcode content</div>
                    <div id="fullText" class="mono"></div>
                </div>
                <div class="actions">
                    <button id="downloadPng" class="secondary">Download PNG</button>
                    <button id="clearResult" class="ghost">Clear</button>
                </div>
            </div>
            <div class="barcode-wrap">
                <canvas id="barcodeCanvas"></canvas>
            </div>
        </section>

        <section class="card">
            <div class="list-header">
                <h2>Saved bonus codes</h2>
                <label class="toggle">
                    <input type="checkbox" id="toggleArchived">
                    <span>Show archived</span>
                </label>
            </div>
            <ul id="codesList" class="codes-list" aria-live="polite"></ul>
            <div id="emptyState" class="empty">No saved codes yet. Generate one to save it here.</div>
        </section>

        <footer>
            <small>
                Barcode history  stored locally in <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage">localStorage</a> · Barcodes generated client-side using <a href="https://github.com/lindell/JsBarcode" target="_blank" rel="noreferrer noopener">JsBarcode</a>
                · <a href="https://github.com/doubleyouthree/wm-barcode-generator" target="_blank" rel="noreferrer noopener">GitHub repo</a>
            </small>
        </footer>
    </div>

    <script>
(() => {
    const PREFIX = '79936686504000';
    const STORAGE_KEY = 'wm_barcodes_v1';

    /** @typedef {{ id:string, code16:string, full:string, status:'new'|'partial'|'archived', createdAt:number }} SavedCode */

    const form = document.getElementById('barcode-form');
    const input = document.getElementById('bonusCode');
    const errorEl = document.getElementById('error');
    const resultCard = document.getElementById('result-card');
    const fullTextEl = document.getElementById('fullText');
    const canvas = document.getElementById('barcodeCanvas');
    const btnDownload = document.getElementById('downloadPng');
    const btnClear = document.getElementById('clearResult');
    const listEl = document.getElementById('codesList');
    const emptyState = document.getElementById('emptyState');
    const toggleArchived = document.getElementById('toggleArchived');

    function loadSaved() {
        try {
            const raw = localStorage.getItem(STORAGE_KEY);
            if (!raw) return [];
            const parsed = JSON.parse(raw);
            if (!Array.isArray(parsed)) return [];
            return parsed;
        } catch { return []; }
    }

    /** @param {SavedCode[]} data */
    function saveAll(data) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    function validate(code16) {
        if (!/^\d{16}$/.test(code16)) {
            return 'Please enter exactly 16 digits (0-9).';
        }
        return '';
    }

    function buildFull(code16) { return `${PREFIX}${code16}`; }

    function renderBarcodeToCanvas(text) {
        JsBarcode(canvas, text, {
            format: 'CODE128',
            displayValue: true,
            font: 'Inter',
            fontSize: 18,
            textMargin: 8,
            margin: 12,
            background: '#0f1420',
            lineColor: '#e6edf3',
            width: 2,
            height: 120,
        });
    }

    function downloadCanvasPng(filename) {
        const link = document.createElement('a');
        link.download = filename;
        link.href = canvas.toDataURL('image/png');
        link.click();
    }

    function uid() {
        return `${Date.now().toString(36)}-${Math.random().toString(36).slice(2, 8)}`;
    }

    function setError(msg) {
        errorEl.textContent = msg || '';
    }

    function ensureEmptyState(hasItems) {
        emptyState.style.display = hasItems ? 'none' : 'block';
    }

    /** @param {SavedCode[]} all */
    function renderList(all) {
        const showArchived = toggleArchived.checked;
        const filtered = all.filter(item => showArchived ? true : item.status !== 'archived');
        ensureEmptyState(filtered.length > 0);
        listEl.innerHTML = '';
        filtered
            .sort((a,b) => b.createdAt - a.createdAt)
            .forEach(item => {
                const li = document.createElement('li');
                li.className = 'codes-item';

                const main = document.createElement('div');
                main.className = 'codes-main';
                const title = document.createElement('div');
                title.className = 'mono';
                title.textContent = `${item.code16}`;
                const meta = document.createElement('div');
                meta.className = 'codes-meta';
                const date = new Date(item.createdAt).toLocaleString();

                const badges = [];
                if (item.status === 'partial') {
                    const b = document.createElement('span');
                    b.className = 'badge partial';
                    b.textContent = 'Partially used';
                    badges.push(b);
                }
                if (item.status === 'archived') {
                    const b = document.createElement('span');
                    b.className = 'badge archived';
                    b.textContent = 'Archived';
                    badges.push(b);
                }
                meta.append(`Saved ${date} · `);
                badges.forEach(b => meta.appendChild(b));

                main.appendChild(title);
                main.appendChild(meta);

                const actions = document.createElement('div');
                actions.className = 'item-actions';

                const btnShow = document.createElement('button');
                btnShow.className = 'secondary';
                btnShow.textContent = 'Show barcode';
                btnShow.addEventListener('click', () => {
                    fullTextEl.textContent = item.full;
                    renderBarcodeToCanvas(item.full);
                    resultCard.hidden = false;
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });

                const btnPartial = document.createElement('button');
                btnPartial.className = 'secondary';
                btnPartial.textContent = item.status === 'partial' ? 'Mark as new' : 'Mark partially used';
                btnPartial.addEventListener('click', () => {
                    const allNow = loadSaved();
                    const found = allNow.find(x => x.id === item.id);
                    if (!found) return;
                    found.status = found.status === 'partial' ? 'new' : 'partial';
                    saveAll(allNow);
                    renderList(allNow);
                });

                const btnArchive = document.createElement('button');
                btnArchive.className = 'danger';
                btnArchive.textContent = item.status === 'archived' ? 'Unarchive' : 'Archive';
                btnArchive.addEventListener('click', () => {
                    const allNow = loadSaved();
                    const found = allNow.find(x => x.id === item.id);
                    if (!found) return;
                    found.status = found.status === 'archived' ? 'new' : 'archived';
                    saveAll(allNow);
                    renderList(allNow);
                });

                actions.appendChild(btnShow);
                actions.appendChild(btnPartial);
                actions.appendChild(btnArchive);

                li.appendChild(main);
                li.appendChild(actions);

                listEl.appendChild(li);
            });
    }

    function onSubmit(e) {
        e.preventDefault();
        const raw = (input.value || '').trim();
        const err = validate(raw);
        setError(err);
        if (err) return;

        const full = buildFull(raw);
        fullTextEl.textContent = full;
        renderBarcodeToCanvas(full);
        resultCard.hidden = false;

        const all = loadSaved();
        const item = { id: uid(), code16: raw, full, status: 'new', createdAt: Date.now() };
        all.push(item);
        saveAll(all);
        renderList(all);
        input.value = '';
        input.focus();
    }

    function init() {
        form.addEventListener('submit', onSubmit);
        input.addEventListener('input', () => {
            // Keep numeric only
            input.value = input.value.replace(/\D+/g, '').slice(0, 16);
            if (errorEl.textContent) setError('');
        });
        btnDownload.addEventListener('click', () => {
            const text = fullTextEl.textContent || '';
            if (!text) return;
            downloadCanvasPng(`${text}.png`);
        });
        btnClear.addEventListener('click', () => {
            resultCard.hidden = true;
            fullTextEl.textContent = '';
            const ctx = canvas.getContext('2d');
            if (ctx) { ctx.clearRect(0, 0, canvas.width, canvas.height); }
        });
        toggleArchived.addEventListener('change', () => renderList(loadSaved()));

        renderList(loadSaved());
    }

    document.addEventListener('DOMContentLoaded', init);
})();
    </script>
</body>
</html>


